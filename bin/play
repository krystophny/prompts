#!/bin/bash
# QADS Play Workflow Shortcut  
# Triggers: Quality audit pipeline for defect detection

set -e

echo "AUDIT: QADS Play Workflow"
echo "Triggering quality audit pipeline:"
echo "1. max-devops: Clean repository state assessment"
echo "2. winny-writer: Documentation audit and consolidation"
echo "3. patrick-auditor: Dead code detection"
echo "4. vicky-tester: Bug detection and issue filing"
echo "5. chris-architect: BACKLOG.md updates with new defects"
echo ""

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "ERROR: Must be run from within a git repository"
    exit 1
fi

# Check if Claude Code is available
if ! command -v claude &> /dev/null; then
    echo "WARNING: Claude Code CLI not found. This script requires Claude Code."
    echo "   Please install Claude Code CLI and ensure it's in your PATH."
    exit 1
fi

# Check if BACKLOG.md exists
if [ ! -f "BACKLOG.md" ]; then
    echo "WARNING: BACKLOG.md not found. This may be created during audit."
fi

# Validate that TODO section is empty (requirement for PLAY workflow)
if [ -f "BACKLOG.md" ] && grep -A 5 "## TODO" BACKLOG.md | grep -q "^\- \["; then
    echo "WARNING: BACKLOG.md has TODO items. Consider completing 'work' workflow first."
    echo "   PLAY workflow is designed for defect detection when TODO list is empty."
fi

echo "SUCCESS: Environment validated"
echo ""
echo "STARTING: Invoking play workflow..."
echo "   Next: Execute 'claude play' or provide quality audit requirements"
echo ""
echo "Expected outputs:"
echo "- Clean repository state (git clean -fdx in separate worktree)"
echo "- Complete documentation rewrite"  
echo "- Dead code detection and removal suggestions"
echo "- Bug detection and GitHub issue filing"
echo "- Updated BACKLOG.md with defect fixes as new TODO items"
echo ""
echo "WARNING: FOCUS: Defects and cleanup only - NO new features"